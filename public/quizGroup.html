<!DOCTYPE html>
<html>
<head>
	<title> Group Quiz </title>
	   <script src="http://code.jquery.com/jquery-1.6.2.min.js"></script>	
       <link rel="stylesheet" type="text/css" href="stylesheets/style.css">

	<script type="text/javascript">
          
           // Find quiz by id in database
           var id = 0;
           var width = 0;

         
           $(function(){

                $('.button').click(function(e){
                    e.preventDefault();
                    
                    if( id < 10)
                    {
                        // Advance only if there is a correct answer
                    	if( document.getElementById('option1').style.background == "green" ||
                    		document.getElementById('option2').style.background == "green" ||
                    		document.getElementById('option3').style.background == "green" || 
                    		document.getElementById('option4').style.background == "green" ||
                    		id == 0)
                    	{
	                        id++;

	                         if(id != 1)
                         	move();
	                    }
	                    else
	                    {

	                    }

                         
                       
                        // Reset
	                    resetBackground();

						var data = {};
							data.id = id;
							
							$.ajax({
								type: 'get',
								data: data,
						        contentType: 'application/json',
		                        url: 'https://pure-sands-99613.herokuapp.com/getquiz',						
		                        success: function(data) {

		                            console.log('success');
		                            console.log(data);
		                            var myData = JSON.stringify(data);
		                            var parseDate = JSON.parse(myData);

                                    parseJson(parseDate);

		                        }
		                    });
					}
					else
					{
						resetAll();
					}
                });				
            });

           function parseJson(parseDate)
           {

		        document.getElementById("question").innerHTML = id + ". " + parseDate[0].question;
		        document.getElementById("option1").innerHTML = parseDate[0].option1;
		        document.getElementById("option2").innerHTML = parseDate[0].option2;
	            document.getElementById("option3").innerHTML = parseDate[0].option3;
	            document.getElementById("option4").innerHTML = parseDate[0].option4;
	            document.getElementById("button1").innerHTML = "Next Question";
	            document.getElementById("head").innerHTML = "Ten Questions About Countries";

	            document.getElementsByTagName("DIV")[0].setAttribute("class", "myBox");
	            document.getElementsByTagName("DIV")[1].setAttribute("class", "myBox1"); 
	            document.getElementsByTagName("DIV")[2].setAttribute("class", "myBox1"); 
	            document.getElementsByTagName("DIV")[3].setAttribute("class", "myBox1"); 
	            document.getElementsByTagName("DIV")[4].setAttribute("class", "myBox1"); 
	            if( id == 1)
	            {
	                document.getElementById('myProgress').setAttribute("style","width:500px");	
	            	document.getElementById("myBar").innerHTML = "0%";	
	           	}
	            document.getElementsByTagName("BUTTON")[0].setAttribute("class", "buttom");
           }

           function resetBackground(){
                
                // Reset Background
           	    document.getElementById('option1').style.background = "lightgrey";
	            document.getElementById('option2').style.background = "lightgrey";
	            document.getElementById('option3').style.background = "lightgrey";
	            document.getElementById('option4').style.background = "lightgrey";

                // Reset Color
	            document.getElementById('option1').style.color = "Black";
	            document.getElementById('option2').style.color = "Black";
	            document.getElementById('option3').style.color = "Black";
	            document.getElementById('option4').style.color = "Black";
           }

            

           function ChangeColor(elementId)
           {

           		if( document.getElementById(elementId).style.backgroundColor != "green")
           		{
           			document.getElementById(elementId).style.background = "Navy";
  					document.getElementById(elementId).style.color = "White";
  				}
           }

           function changeBack(elementId)
           {
           		if( document.getElementById(elementId).style.backgroundColor != "green")
           		{
           			document.getElementById(elementId).style.background = "lightgrey";
  					document.getElementById(elementId).style.color = "Black";
          		 }
           }

           function checkAnswer(elementId){

           	    var data = {};
					data.answer = document.getElementById(elementId).getAttribute('value');
					data.id = id;
				

           		$.ajax({
						type: 'get',
						data: data,
				        contentType: 'application/json',
                        url: 'http://localhost:5000/getanswer',						
                        success: function(data) {

                            console.log('success');
                            console.log(data);
                            var myData = JSON.stringify(data);
                            var parseDate = JSON.parse(myData);
                            if (parseDate[0].answer === undefined || parseDate[0].answer === null) {
                               document.getElementById(elementId).style.backgroundColor = "red";
							}	
							else{
                              document.getElementById(elementId).style.backgroundColor = "green";
                            }

                        }
                    });

           }


           function resetAll(){

           	 		document.getElementById("question").innerHTML = "";
		            document.getElementById("option1").innerHTML = "";
		            document.getElementById("option2").innerHTML = "";
		            document.getElementById("option3").innerHTML = "";
		            document.getElementById("option4").innerHTML = "";
		            document.getElementById("button1").innerHTML = "Press Ok";
		            document.getElementById("head").innerHTML = "";
		            document.getElementById("final").innerHTML = "Congratulations! You have completed the Quiz";
		            document.getElementsByTagName("DIV")[0].setAttribute("class", "myBox2");
		            document.getElementsByTagName("DIV")[1].setAttribute("class", "myBox2"); 
		            document.getElementsByTagName("DIV")[2].setAttribute("class", "myBox2"); 
		            document.getElementsByTagName("DIV")[3].setAttribute("class", "myBox2"); 
		            document.getElementsByTagName("DIV")[4].setAttribute("class", "myBox2");
		            document.getElementsByTagName("DIV")[5].setAttribute("class", "final"); 
		            document.getElementsByTagName("BUTTON")[0].setAttribute("class", "final final1"); 
		            move();

           }


             function move() {

					var elem = document.getElementById('myBar');
					
					width += 10;
					var myId = setInterval(frame, 10);
					function frame() {
					if (width > 100) {
					  clearInterval(myId);
					} else {
					  elem.style.width = width + '%'; 
					  elem.innerHTML = width * 1  + '%';
					}
				}
			}



			function mDown(obj) {
			   if( document.getElementById('option1').style.background == "green" ||
                   document.getElementById('option2').style.background == "green" ||
                   document.getElementById('option3').style.background == "green" || 
                   document.getElementById('option4').style.background == "green" 
                    		)
			   {
 			   	   obj.style.backgroundColor = "Lime";
    		   	   obj.innerHTML = "Correct Answer";
    		   }
    		   else if( id ===0)
    		   {

    		   }
    		   else
    		   {
    		   	   obj.style.backgroundColor = "Red";
    		   	   obj.innerHTML = "Select Answer";
    		   }
			}

			function mUp(obj) {
    			obj.style.backgroundColor="DarkBlue";
 
            }

  	</script>
</head>
<body>
<h1 id="head">Welcome Group 3</h1>

<form action="" method="get" id="form">

<input type="hidden" id="id" value="1" >
	 <button onmousedown="mDown(this)" onmouseup="mUp(this)" class="button button2" id="button1">Start Quiz</button> 

</form>

<div id="question"></div><br>
<div onmouseover="ChangeColor(this.id)" onmouseleave="changeBack(this.id)" onclick="checkAnswer(this.id)" value="option1" id="option1">
</div><br>

<div onmouseover="ChangeColor(this.id)" onmouseleave="changeBack(this.id)" onclick="checkAnswer(this.id)" value="option2" id="option2">
</div><br>

<div onmouseover="ChangeColor(this.id)" onmouseleave="changeBack(this.id)" onclick="checkAnswer(this.id)" value="option3" id="option3">
</div><br>

<div onmouseover="ChangeColor(this.id)" onmouseleave="changeBack(this.id)" onclick="checkAnswer(this.id)" value="option4" id="option4">
</div><br>
<div id="final"><div><br>


<div id="myProgress" >
  <div id="myBar"></div>
</div>

</body>
</html>